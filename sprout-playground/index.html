<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="index, follow">

  <title>Sprout Playground</title> <!-- Change the title -->
  <link rel="stylesheet" href="styles.css">


</head>

<body>


  <div class="welcome-screen" onclick="closeWelcomeScreen()">

    <p>Click anywhere to start!</p>


  </div>


  <div class="background-image-container">

    <div class="image-holder">

      <img src="images/3.webp" alt="bck" class="background-image">

      <a href="https://x.com/SproutCitizens" target="_blank">
        <div class="house-image-container">
          <img src="images/house test.webp" alt="house">
        </div>
      </a>


      <div class="disabled-house-image-container" onclick="playLottie()">
        <img src="images/locked-house-test.webp" alt="house">
        <div class="lock-lottie-container">
          <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
            type="module"></script>
          <dotlottie-player id="lockLottie" class="lottie-box"
            src="https://lottie.host/43e64774-d956-4e71-994a-ecf447673795/MXCZTO7exS.lottie" background="transparent"
            speed="1"></dotlottie-player>
        </div>
      </div>





    </div>

  </div>

  <!-- Div to toggle audio -->
  <div class="audio-toggle" id="audio-toggle">
    <img src="images/SPEAKER-2.webp" id="audio-icon" alt="Speaker Icon">
  </div>

  <audio id="bg-music" loop>
    <source src="music/bck music.MP3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <audio id="click-sound">
    <source src="music/click on.MP3" type="audio/mpeg">
  </audio>

  <audio id="release-sound">
    <source src="music/click off.MP3" type="audio/mpeg">
  </audio>

  <audio id="lockSound" src="music/locked.MP3" preload="auto"></audio>




  <script>
    function playLottie() {
      const houseImage = document.querySelector('.disabled-house-image-container img');
      const lottie = document.getElementById('lockLottie');
      const lockSound = document.getElementById('lockSound');  // Get the audio element

      // Play the lock sound only if the audio is not muted
      if (!isMuted) {
        lockSound.play();
      }

      // Add the shake effect to the house image
      houseImage.classList.add('shake');

      // Stop and play the Lottie animation
      lottie.stop();
      lottie.play();

      // Remove the shake effect after 0.3s (duration of animation)
      setTimeout(() => {
        houseImage.classList.remove('shake');
      }, 300);
    }

    window.onload = function () {
      // Check if the user has already closed the welcome screen
      if (!localStorage.getItem('welcomeClosed')) {
        document.querySelector('.welcome-screen').classList.remove('hidden');
      }

      // Try starting audio after page load
      startAudio();
    };

    function closeWelcomeScreen() {
      // Hide the welcome screen and remember the action
      document.querySelector('.welcome-screen').classList.add('hidden');
      localStorage.setItem('welcomeClosed', 'true');
    }

    const audio = document.getElementById("bg-music");
    const audioToggle = document.getElementById("audio-toggle");
    const audioIcon = document.getElementById("audio-icon");
    const clickSound = document.getElementById("click-sound");
    const releaseSound = document.getElementById("release-sound");

    let isMuted = localStorage.getItem('audioMuted') === 'true'; // Retrieve the muted state from localStorage

    // Function to fade volume
    function fadeAudio(targetVolume, callback) {
      let currentVolume = audio.volume;
      const fadeTime = 300; // 0.3 seconds
      const steps = 30;
      const volumeStep = (currentVolume - targetVolume) / steps;
      let stepCount = 0;

      const fadeInterval = setInterval(() => {
        stepCount++;
        audio.volume = Math.max(0, Math.min(1, audio.volume - volumeStep));

        if (stepCount >= steps) {
          clearInterval(fadeInterval);
          if (callback) callback();
        }
      }, fadeTime / steps);
    }

    // Function to start the audio after user interaction or when the page loads
    function startAudio() {
      // Only start audio if it's not muted
      if (!isMuted) {
        audio.volume = 1;
        audio.play().catch((e) => {
          console.log("Auto-play blocked, retrying after user interaction.");
          document.addEventListener("click", playAudioOnClick); // Retry after user interaction
          document.addEventListener("touchstart", playAudioOnClick); // Retry on touch
        });
      } else {
        audio.volume = 0; // Keep audio muted if it is
      }

      // Update the icon based on the muted state
      updateAudioIcon();
    }

    // Function to handle retrying play after user interaction
    function playAudioOnClick() {
      audio.play().catch((e) => console.log("Still blocked, please allow audio to play"));
      document.removeEventListener("click", playAudioOnClick); // Remove listener after success
      document.removeEventListener("touchstart", playAudioOnClick); // Remove listener after success
    }

    // Update the audio icon based on the muted state
    function updateAudioIcon() {
      if (isMuted) {
        audioIcon.src = 'images/SPEAKER-1.webp'; // Muted icon
      } else {
        audioIcon.src = 'images/SPEAKER-2.webp'; // Unmuted icon
      }
    }

    // Toggle background music and update icon when div is clicked
    audioToggle.addEventListener("click", () => {
      if (audio.paused) {
        audio.volume = 0;
        audio.play();
        fadeAudio(1);
        isMuted = false;
      } else {
        fadeAudio(0, () => audio.pause());
        isMuted = true;
      }

      // Update the icon and store the muted state
      localStorage.setItem('audioMuted', isMuted.toString());
      updateAudioIcon();
    });

    // Handle mouse click event
    function handleClickEvent() {
      if (!isMuted) clickSound.play();
    }

    function handleReleaseEvent() {
      if (!isMuted) releaseSound.play();
    }

    // Handle touch events for small screens (<= 700px)
    function handleTouchEvents() {
      if (window.innerWidth <= 700) {
        document.addEventListener("touchstart", handleClickEvent);
        document.addEventListener("touchend", handleReleaseEvent);
      } else {
        document.removeEventListener("touchstart", handleClickEvent);
        document.removeEventListener("touchend", handleReleaseEvent);
      }
    }

    // Handle mouse events for large screens (> 700px)
    function handleMouseEvents() {
      if (window.innerWidth > 700) {
        document.addEventListener("mousedown", handleClickEvent);
        document.addEventListener("mouseup", handleReleaseEvent);
      } else {
        document.removeEventListener("mousedown", handleClickEvent);
        document.removeEventListener("mouseup", handleReleaseEvent);
      }
    }

    // Initial event listener setup
    handleTouchEvents();
    handleMouseEvents();

    // Recheck and adjust listeners on window resize
    window.addEventListener("resize", () => {
      handleTouchEvents();
      handleMouseEvents();
    });

    // Initialize the audio and icon based on the muted state
    updateAudioIcon();

  </script>

</body>

</html>